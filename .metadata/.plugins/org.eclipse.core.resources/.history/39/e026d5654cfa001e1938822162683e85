package pcp.porta;

import pcp.Settings;
import pcp.model.BuilderStrategy;
import pcp.porta.processing.Cardinals;


public class Main {
	
	public static void main(String[] args) throws Exception {
		
		if (args.length == 0) {
			System.out.println("Must specify an action");
			return;
		}
		
		Settings.load("porta");
		
		BuilderStrategy strategy = BuilderStrategy.fromSettings();
		
		String basefilename = Settings.get().getPath("file.basename", "dir.porta");
		String detailedfilename = createFilename(basefilename, strategy, Settings.get().getBoolean("porta.projectColors"));
		String detailedname = createFilename(Settings.get().getString("file.basename"), strategy, Settings.get().getBoolean("porta.projectColors"));
		
		String graphfile = basefilename + ".in";
		String ieqfile = detailedfilename + ".ieq";
		String poifile = detailedfilename + ".poi";
		String traffile = detailedfilename + ".poi.ieq";
		String modelfile = detailedfilename + ".model";
		
		Integer nodeCount = Settings.get().getInteger("porta.nodeCount");
		Integer colorCount = Settings.get().getInteger("porta.colorCount");
		
		Cardinals cardinals = new Cardinals(nodeCount, colorCount);
		
		Boolean preprocess = Settings.get().getBoolean("writer.preprocess");

		String action = args[0];
		if (action.equalsIgnoreCase("--ieq")) {
			System.out.println("Writing ieq file from input graph");
			WriteIeq.write(graphfile, ieqfile, preprocess, strategy);
		} else if (action.equalsIgnoreCase("--process")) {
			System.out.println("Processing ieq file");
			ProcessIeq.process(graphfile, traffile, modelfile, cardinals, strategy);
		} else if (action.equalsIgnoreCase("--name")) {
			System.out.println(detailedname);
		} else if (action.equalsIgnoreCase("--poi")) {
			System.out.println("Writing poi file from input graph");
			WritePoi.write(graphfile, poifile, strategy);
		}else {
			System.out.println("Invalid action specified " + args[0]);
		}
	}

	private static String createFilename(String basefilename, BuilderStrategy strategy, Boolean projectColors) {
		String portanames = Settings.get().getString("porta.filenames");
		if () {
			String ret = basefilename + "." + strategy.shortId();
			if (projectColors) ret += ".proj";
			return ret;
		} else {
			return basefilename;
		}
	}

	
	
}
